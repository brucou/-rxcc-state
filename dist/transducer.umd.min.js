!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.StateTranducer={})}(this,function(exports){"use strict";const CONTRACT_MODEL_UPDATE_FN_RETURN_VALUE="Model update function must return valid update operations!",SEP=".",TRANSITION_SYMBOL="--\x3e",TRANSITION_LABEL_START_SYMBOL=":",HISTORY_STATE_NAME="H",HISTORY_PREFIX="history.",INITIAL_STATE_NAME="nok",INIT_EVENT="init",AUTO_EVENT="auto",STATE_PROTOTYPE_NAME="State",NO_MODEL_UPDATE=[],NO_OUTPUT=null,default_action_result={model_update:NO_MODEL_UPDATE,output:NO_OUTPUT};var pSlice=Array.prototype.slice,objectKeys=Object.keys;function isArguments(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function isUndefinedOrNull(t){return null==t}function isBuffer(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function objEquiv(t,e,n){var r,o;if(isUndefinedOrNull(t)||isUndefinedOrNull(e))return!1;if(t.prototype!==e.prototype)return!1;if(isArguments(t))return!!isArguments(e)&&deepEqual(t=pSlice.call(t),e=pSlice.call(e),n);if(isBuffer(t)){if(!isBuffer(e))return!1;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}try{var a=objectKeys(t),s=objectKeys(e)}catch(t){return!1}if(a.length!=s.length)return!1;for(a.sort(),s.sort(),r=a.length-1;r>=0;r--)if(a[r]!=s[r])return!1;for(r=a.length-1;r>=0;r--)if(!deepEqual(t[o=a[r]],e[o],n))return!1;return typeof t==typeof e}function deepEqual(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?n.strict?t===e:t==e:objEquiv(t,e,n))}var __extends=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},_hasOwnProperty=Object.prototype.hasOwnProperty;function hasOwnProperty(t,e){return _hasOwnProperty.call(t,e)}function _objectKeys(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);e=[];for(var r in t)hasOwnProperty(t,r)&&e.push(r);return e}function _deepClone(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function isInteger(t){for(var e,n=0,r=t.length;n<r;){if(!((e=t.charCodeAt(n))>=48&&e<=57))return!1;n++}return!0}function unescapePathComponent(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function hasUndefined(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(hasUndefined(t[e]))return!0}else if("object"==typeof t){var r=_objectKeys(t),o=r.length;for(e=0;e<o;e++)if(hasUndefined(t[r[e]]))return!0}return!1}var PatchError=function(t){function e(e,n,r,o,a){t.call(this,e),this.message=e,this.name=n,this.index=r,this.operation=o,this.tree=a}return __extends(e,t),e}(Error),equalsOptions={strict:!0},areEquals=function(t,e){return deepEqual(t,e,equalsOptions)},JsonPatchError=PatchError,objOps={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=getValueByPointer(n,this.path);r&&(r=_deepClone(r));var o=applyOperation(n,{op:"remove",path:this.from}).removed;return applyOperation(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=getValueByPointer(n,this.from);return applyOperation(n,{op:"add",path:this.path,value:_deepClone(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:areEquals(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},arrOps={add:function(t,e,n){return isInteger(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){return{newDocument:n,removed:t.splice(e,1)[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};function getValueByPointer(t,e){if(""==e)return t;var n={op:"_get",path:e};return applyOperation(t,n),n.value}function applyOperation(t,e,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!0),n&&("function"==typeof n?n(e,0,t,e.path):validator(e,0)),""===e.path){var o={newDocument:t};if("add"===e.op)return o.newDocument=e.value,o;if("replace"===e.op)return o.newDocument=e.value,o.removed=t,o;if("move"===e.op||"copy"===e.op)return o.newDocument=getValueByPointer(t,e.from),"move"===e.op&&(o.removed=t),o;if("test"===e.op){if(o.test=areEquals(t,e.value),!1===o.test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,e,t);return o.newDocument=t,o}if("remove"===e.op)return o.removed=t,o.newDocument=null,o;if("_get"===e.op)return e.value=t,o;if(n)throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,e,t);return o}r||(t=_deepClone(t));var a=(e.path||"").split("/"),s=t,i=1,_=a.length,c=void 0,u=void 0,p=void 0;for(p="function"==typeof n?n:validator;;){if(u=a[i],n&&void 0===c&&(void 0===s[u]?c=a.slice(0,i).join("/"):i==_-1&&(c=e.path),void 0!==c&&p(e,0,t,c)),i++,Array.isArray(s)){if("-"===u)u=s.length;else{if(n&&!isInteger(u))throw new JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,e.path,e);isInteger(u)&&(u=~~u)}if(i>=_){if(n&&"add"===e.op&&u>s.length)throw new JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,e.path,e);if(!1===(o=arrOps[e.op].call(e,s,u,t)).test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,e,t);return o}}else if(u&&-1!=u.indexOf("~")&&(u=unescapePathComponent(u)),i>=_){if(!1===(o=objOps[e.op].call(e,s,u,t)).test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,e,t);return o}s=s[u]}}function applyPatch(t,e,n,r){if(void 0===r&&(r=!0),n&&!Array.isArray(e))throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=_deepClone(t));for(var o=new Array(e.length),a=0,s=e.length;a<s;a++)o[a]=applyOperation(t,e[a],n),t=o[a].newDocument;return o.newDocument=t,o}function validator(t,e,n,r){if("object"!=typeof t||null===t||Array.isArray(t))throw new JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(!objOps[t.op])throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n);if("string"!=typeof t.path)throw new JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&hasUndefined(t.value))throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n)if("add"==t.op){var o=t.path.split("/").length,a=r.split("/").length;if(o!==a+1&&o!==a)throw new JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if("move"===t.op||"copy"===t.op){var s=validate([{op:"_get",path:t.from,value:void 0}],n);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}function validate(t,e,n){try{if(!Array.isArray(t))throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)applyPatch(_deepClone(e),_deepClone(t),n||!0);else{n=n||validator;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(t){if(t instanceof JsonPatchError)return t;throw t}}function get_fn_name(t){return/^[\s\r\n]*function[\s\r\n]*([^\(\s\r\n]*?)[\s\r\n]*\([^\)\s\r\n]*\)[\s\r\n]*\{((?:[^}]*\}?)+)\}\s*$/.exec(t.toString())[1]}function wrap(t){return["-",t,"-"].join("")}function times(t,e){return Array.apply(null,{length:e}).map(Number.call,Number).map(t)}function applyUpdateOperations(t,e){return assertContract(isArrayUpdateOperations,[e],`applyUpdateOperations : ${CONTRACT_MODEL_UPDATE_FN_RETURN_VALUE}`),applyPatch(t,e,!0,!1).newDocument}function always(t){return t}function keys(t){return Object.keys(t)}function assertContract(t,e,n){const r=t.apply(null,e);if(!(isBoolean(r)&&r))throw`assertContract: fails contract ${t.name}\n${n}\n ${r}`;return!0}function isBoolean(t){return"boolean"==typeof t}function isUpdateOperation(t){return"object"==typeof t&&0===Object.keys(t).length||["add","replace","move","test","remove","copy"].some(e=>t.op===e)&&"string"==typeof t.path}function isEmptyArray(t){return Array.isArray(t)&&0===t.length}function isArrayOf(t){return e=>Array.isArray(e)&&e.every(t)}function isArrayUpdateOperations(t){return isEmptyArray(t)||isArrayOf(isUpdateOperation)(t)}function is_history_transition(t){return t.to.startsWith(HISTORY_PREFIX)}function is_entry_transition(t){return t.event===INIT_EVENT}function is_from_control_state(t){return function(e){return e.from===t}}function is_to_history_control_state_of(t){return function(e){return is_history_control_state_of(t,e.to)}}function is_history_control_state_of(t,e){return e.substring(HISTORY_PREFIX.length)===t}function format_transition_label(t,e,n){const r=t||"";return e&&n?`${r} [${e.name}] / ${n.name}`:e?`${r} [${e.name}]}`:n?`${r} / ${n.name}`:`${r}`}function format_history_transition_state_name({from:t,to:e}){return`${t}.${e.substring(HISTORY_PREFIX.length)}.${HISTORY_STATE_NAME}`}function get_all_transitions(t){const{from:e,event:n,guards:r}=t;return r?r.map(({predicate:t,to:r,action:o})=>({from:e,event:n,predicate:t,to:r,action:o})):[t]}function displayName(t){return t.replace(/_/g," ")}function build_event_enum(t){return(t=t.reduce?t:Array.prototype.slice.call(arguments)).push(INIT_EVENT),t.reduce(function(t,e){return t[e]=e,t},{})}function build_nested_state_structure(states,event_emitter_factory){const root_name="State",last_seen_state_event_emitter=event_emitter_factory();let hash_states={},last_seen_state_listener_disposables=[],is_group_state={};function add_last_seen_state_listener(t,e){last_seen_state_listener_disposables.push(last_seen_state_event_emitter.subscribe(function(n){const r=n.event_emitter_name,o=n.last_seen_state_name;r===t&&(console.log(["last seen state set to",wrap(o),"in",wrap(e)].join(" ")),hash_states[e].history.last_seen_state=o)}))}function build_state_reducer(states,curr_constructor){keys(states).forEach(function(state_name){const state_config=states[state_name];let curr_constructor_new;hash_states[state_name]=new curr_constructor,hash_states[state_name].name=state_name;const parent_name=hash_states[state_name].parent_name=get_fn_name(curr_constructor);hash_states[state_name].root_name=root_name,hash_states[state_name].history={last_seen_state:null},hash_states[state_name].active=!1,add_last_seen_state_listener(state_name,parent_name),"object"==typeof state_config&&(is_group_state[state_name]=!0,eval(["curr_constructor_new = function",state_name,"(){}"].join(" ")),curr_constructor_new.displayName=state_name,curr_constructor_new.prototype=hash_states[state_name],build_state_reducer(state_config,curr_constructor_new))})}function State(){this.history={last_seen_state:null}}return states={nok:states},State.prototype={emitLastSeenStateEvent:function(t){last_seen_state_event_emitter.onNext(t)},current_state_name:INITIAL_STATE_NAME},hash_states[INITIAL_STATE_NAME]=new State,hash_states[STATE_PROTOTYPE_NAME]=new State,build_state_reducer(states,State),{hash_states:hash_states,is_group_state:is_group_state}}function build_state_enum(states){let states_enum={history:{}};function build_state_reducer(states){keys(states).forEach(function(state_name){const state_config=states[state_name];let state_name_history_fn;states_enum[state_name]=state_name,eval(["state_name_history_fn = function","_"+state_name,"(){}"].join(" ")),states_enum.history[state_name]=state_name_history_fn,"object"==typeof state_config&&build_state_reducer(state_config)})}return states_enum.NOK=INITIAL_STATE_NAME,build_state_reducer(states),states_enum}function create_state_machine(t,e){const{states:n,events:r,transitions:o,initial_extended_state:a}=t,s=e&&e.subject_factory;if(!s)throw"create_state_machine : cannot find a subject factory (use Rxjs subject??)";const i=build_state_enum(n),_=build_event_enum(r),c=build_nested_state_structure(i,s);let u=a,p={},l={};const f=c.is_group_state;let d=c.hash_states;function h(t){console.log("send event",t);const e=keys(t)[0],n=t[e];return function(t,e,n,r){console.log("Processing event ",e,n);const o=t[INITIAL_STATE_NAME].current_state_name,a=t[o][e];if(a){console.log("found event handler!"),console.info("WHEN EVENT ",e);const o=a(r,n,s).output,s=t[INITIAL_STATE_NAME].current_state_name;return l[s]?h({[AUTO_EVENT]:n}):o}return console.error("There is no transition associated to that event!"),NO_OUTPUT}(c.hash_states,e,n,u)}return o.forEach(function(t){console.log("processing transition:",t);let{from:n,to:r,action:o,event:a,guards:s}=t;s||(s=[{predicate:s,to:r,action:o}]),a===INIT_EVENT&&(p[n]=!0);let i=d[n];if(a&&!(a in _))throw`unknown event ${a} found in state machine definition!`;a||(a=AUTO_EVENT,l[n]=!0),f[n]&&p[n]&&(l[n]=!0),console.log("This is transition for event:",a),console.log("Predicates:",s),i[a]=s.reduce(function(t,r,o){let a=r.action;console.log("Guard:",r);const s=function(t,e){let r="";const s=function(s,i,_){n=_||n;const{predicate:c,to:p}=t;r=c?"_checking_condition_"+o:"";let l=default_action_result;if(!c||c(s,i,e)){console.info("IN STATE ",n),console.info("WITH model, event data, settings BEING ",s,i,e),console.info("CASE : "+(c?"guard "+c.name+" for transition is fulfilled":"automatic transition")),a&&(console.info("THEN : we execute the action "+a.name),l=a(s,i,e)),function(t,e,n){const r=n[t],o=r.name;r.history.last_seen_state=o,r.active=!1,console.log("left state",wrap(t)),r.emitLastSeenStateEvent({event_emitter_name:o,last_seen_state_name:o})}(n,0,d),u=function(t,e){return applyUpdateOperations(t,e)}(s,l.model_update),console.info("RESULTING IN : ",u),console.info("RESULTING IN OUTPUT : ",l.output);const t=function(t,e,n){let r,o;if("function"==typeof t){o=get_fn_name(t);const e=n[o].history.last_seen_state;r=n[o=e||o]}else{if(!t)throw"enter_state : unknown case! Not a state name, and not a history state to enter!";r=n[t],o=r.name}return r.active=!0,n[INITIAL_STATE_NAME].current_state_name=o,console.info("AND TRANSITION TO STATE",o),o}(p,l.model_update,d);return console.info("ENTERING NEXT STATE : ",t),{stop:!0,output:l.output}}return console.log("CASE : "+(c?"guard "+c.name+" for transition NOT fulfilled...":"no predicate")),{stop:!1,output:NO_OUTPUT}};return s.displayName=n+r,s}(r,e);return function(e,n,r){const o=t(e,n,r);return o.stop?o:s(e,n,r)}},function(){return{stop:!1,output:NO_OUTPUT}})}),{yield:h,start:function(){return h({[INIT_EVENT]:a})}}}function makeStreamingStateMachine(t,e){const n=create_state_machine(e,t),r=t&&t.merge,o=t&&t.of;if(!r||!o)throw"makeStreamingStateMachine : could not find an observable merge or of functions ! use Rx??";return function(t){return r(o({[INIT_EVENT]:e.initial_extended_state}),keys(t).map(e=>t[e].map(t=>n.yield({[e]:t})))).filter(t=>t!=NO_OUTPUT)}}const PATH_ROOT=[0];function clone(t){return void 0===t?void 0:JSON.parse(JSON.stringify(t))}function merge(t,e){return Object.assign({},t,e)}function updatePathInTraversalState(t,e,n){n.forEach((n,r)=>{const o=t.get(e),a=t.get(n),s=a&&a.path;t.set(n,merge(a,{isAdded:!0,isVisited:!1,path:s||o.path.concat(r)}))})}function updateVisitInTraversalState(t,e){t.set(e,merge(t.get(e),{isVisited:!0}))}function visitTree(t,e){const{store:n,lenses:r,traverse:o}=t,{empty:a,add:s,takeAndRemoveOne:i,isEmpty:_}=n,{getChildren:c}=r,{visit:u,seed:p}=o,l=new Map,f="function"==typeof p?new(p()):clone(p);let d="function"==typeof a?new(a()):clone(a),h=f;for(s([e],d),l.set(e,{isAdded:!0,isVisited:!1,path:PATH_ROOT});!_(d);){const t=i(d),e=c(l,t);s(e,d),updatePathInTraversalState(l,t,e),h=u(h,l,t),updateVisitInTraversalState(l,t)}return l.clear(),h}function postOrderTraverseTree(t,e,n){const{getChildren:r}=t,{seed:o,visit:a}=e,s=(t,e)=>e.get(t).isVisited||((t,e)=>0===r(t,e).length)(t,e);return visitTree({store:{empty:[],takeAndRemoveOne:t=>t.shift(),isEmpty:t=>0===t.length,add:(t,e)=>e.unshift(...t)},lenses:{getChildren:(t,e)=>s(e,t)?[]:r(e,t).concat([e])},traverse:{seed:o,visit:(t,e,n)=>s(n,e)?a(t,e,n):t}},n)}const objectTreeLenses={getLabel:t=>{if("object"!=typeof t||Array.isArray(t)||1!==Object.keys(t).length)throw"getLabel > unexpected object tree value";return t},getChildren:t=>{if("object"!=typeof t||Array.isArray(t)||1!==Object.keys(t).length)throw"getChildren > unexpected value";{let e=Object.values(t)[0];return"object"!=typeof e||Array.isArray(e)?[]:Object.keys(e).map(t=>({[t]:e[t]}))}},constructTree:(t,e)=>{const n=t&&Object.keys(t)&&Object.keys(t)[0];return 0===e.length?t:{[n]:Object.assign.apply(null,e)}}},arrayTreeLenses={getLabel:t=>Array.isArray(t)?t[0]:t,getChildren:t=>Array.isArray(t)?t[1]:[],constructTree:(t,e)=>e&&Array.isArray(e)&&e.length>0?[t,e]:t};function generateStatePlantUmlHeader(t,e){return e?`state "${e}" as ${t} <<NoContent>>`:`state "${displayName(t)}" as ${t} <<NoContent>>`}function toPlantUml(t,e){const{states:n,transitions:r}=t,{getChildren:o,constructTree:a,getLabel:s}=objectTreeLenses,i=t=>t.join(SEP),_=postOrderTraverseTree(objectTreeLenses,{seed:()=>Map,visit:(t,e,n)=>{const{path:a}=e.get(n),_=s(n),c=stateToPlantUML(Object.keys(_)[0],times(e=>t.get(i(a.concat(e))),((t,e)=>o(t,e).length)(n,e)),r);return t.set(i(a),c),t}},{[INITIAL_STATE_NAME]:n}),c=_.get("0");return _.clear(),c}function stateToPlantUML(t,e,n){return[`${generateStatePlantUmlHeader(t,"")} {`,e.join("\n"),format_history_states(t,n),format_entry_transitions(t,n),"}",translate_transitions(t,n)].filter(t=>"\n"!==t&&""!==t).join("\n")}function format_history_states(t,e){const n=e.reduce((e,n)=>{return get_all_transitions(n).filter(is_history_transition).filter(is_to_history_control_state_of(t)).reduce((t,e)=>(t[format_history_transition_state_name(e)]=void 0,t),e)},{});return Object.keys(n).map(t=>`${generateStatePlantUmlHeader(t,HISTORY_STATE_NAME)}`).join("\n")}function translate_transitions(t,e){return[format_history_transitions(t,e),format_standard_transitions(t,e)].filter(Boolean).join("\n")}function format_standard_transitions(t,e){return t===INITIAL_STATE_NAME?"":e.map(e=>{return get_all_transitions(e).filter(is_from_control_state(t)).filter(t=>!is_entry_transition(t)).filter(t=>!is_history_transition(t)).map(({from:t,event:e,predicate:n,to:r,action:o})=>[t,TRANSITION_SYMBOL,r,TRANSITION_LABEL_START_SYMBOL,format_transition_label(e,n,o)].join(" ")).join("\n")}).filter(Boolean).join("\n")}function format_entry_transitions(t,e){return e.reduce((e,n)=>{return get_all_transitions(n).filter(is_entry_transition).filter(is_from_control_state(t)).reduce((t,e)=>{const{from:n,to:r,predicate:o,action:a}=e;return t.push(`[*] ${TRANSITION_SYMBOL} ${r} ${TRANSITION_LABEL_START_SYMBOL} ${format_transition_label("",o,a)}`),t},e)},[]).join("\n")}function format_history_transitions(t,e){return e.map(e=>{return get_all_transitions(e).filter(is_from_control_state(t)).filter(is_history_transition).map(({from:t,event:e,predicate:n,to:r,action:o})=>[t,TRANSITION_SYMBOL,format_history_transition_state_name({from:t,to:r}),TRANSITION_LABEL_START_SYMBOL,format_transition_label(e,n,o)].join(" ")).join("\n")}).filter(Boolean).join("\n")}function toDagreVisualizerFormat(t){const{states:e,transitions:n}=t,{getLabel:r,getChildren:o}=objectTreeLenses,{constructTree:a}=arrayTreeLenses,s=t=>t.join(SEP),i=postOrderTraverseTree(objectTreeLenses,{seed:()=>Map,visit:(t,e,n)=>{const{path:i}=e.get(n),_=r(n),c=Object.keys(_)[0],u=times(e=>t.get(s(i.concat(e))),((t,e)=>o(t,e).length)(n,e));return t.set(s(i),a(c,u)),t}},{[INITIAL_STATE_NAME]:e}).get("0"),_=n.map(t=>{const{from:e,to:n,event:r,guards:o,action:a}=t;if(o){return{from:e,event:r,guards:o.map(t=>{const{predicate:e,to:n,action:r}=t;return{predicate:e.name,to:n,action:r.name}})}}return{from:e,to:n,event:r,action:a.name||"no action name?"}});return JSON.stringify({states:i,transitions:_})}exports.create_state_machine=create_state_machine,exports.makeStreamingStateMachine=makeStreamingStateMachine,exports.toPlantUml=toPlantUml,exports.toDagreVisualizerFormat=toDagreVisualizerFormat,exports.CONTRACT_MODEL_UPDATE_FN_RETURN_VALUE=CONTRACT_MODEL_UPDATE_FN_RETURN_VALUE,exports.SEP=SEP,exports.TRANSITION_SYMBOL=TRANSITION_SYMBOL,exports.TRANSITION_LABEL_START_SYMBOL=TRANSITION_LABEL_START_SYMBOL,exports.HISTORY_STATE_NAME=HISTORY_STATE_NAME,exports.HISTORY_PREFIX=HISTORY_PREFIX,exports.INIT_STATE=INITIAL_STATE_NAME,exports.INIT_EVENT=INIT_EVENT,exports.AUTO_EVENT=AUTO_EVENT,exports.STATE_PROTOTYPE_NAME=STATE_PROTOTYPE_NAME,exports.NO_MODEL_UPDATE=NO_MODEL_UPDATE,exports.NO_OUTPUT=NO_OUTPUT,exports.default_action_result=default_action_result,exports.get_fn_name=get_fn_name,exports.wrap=wrap,exports.times=times,exports.applyUpdateOperations=applyUpdateOperations,exports.always=always,exports.keys=keys,exports.assertContract=assertContract,exports.isBoolean=isBoolean,exports.isUpdateOperation=isUpdateOperation,exports.isEmptyArray=isEmptyArray,exports.isArrayOf=isArrayOf,exports.isArrayUpdateOperations=isArrayUpdateOperations,exports.is_history_transition=is_history_transition,exports.is_entry_transition=is_entry_transition,exports.is_from_control_state=is_from_control_state,exports.is_to_history_control_state_of=is_to_history_control_state_of,exports.is_history_control_state_of=is_history_control_state_of,exports.format_transition_label=format_transition_label,exports.format_history_transition_state_name=format_history_transition_state_name,exports.get_all_transitions=get_all_transitions,exports.getDisplayName=displayName,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=transducer.umd.min.js.map
